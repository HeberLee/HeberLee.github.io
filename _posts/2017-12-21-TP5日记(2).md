---
layout:     post
title:      TP5日记
subtitle:   视图和模板
date:       2017-12-21
author:     Heber
header-img: img/post-bg-hacker.jpg
catalog: true
tags:
    - TP5
    - 框架
---

## 视图view和fetch、assign、display

在TP5中，它为我们提供了一个可以直接调用的助手函数view，如果调用时，没有为它配置，它会默认到同一模块下寻找view文件夹里的与调用它的控制器名及方法名相对的文件夹和html文件。例如，我在index/controller/index.php的index方法中使用了return view();那么它会寻找index/view/index/index.html文件，找不到会直接报错。除此之外，还可以为它设置参数。

view() -> index/view/index/index.html
view('test') -> index/view/index/test.html
view('heber/test') -> index/view/heber/test.html

如果是view('./test.html')(注意有.html)则会跳转到入口文件index.php同级的地方去寻找test.html文件

view()有第二个参数，作用是往调用的html文件里传参
```objc
<?php
    namespace app\index\controller;

    class Index{
        public function index(){
            $data = [
                'email' => '77766@qq.com',
                'name' => 'heber'
            ];
            return view('',$data);
        }
    }

```
在index.html中，我们可以直接通过{$eamil}来使用这个变量。

但通常，我们是直接使用视图类里的$this->fetch(),它的用法和view()基本一样
```objc
<?php
    namespace app\index\controller;
    use think\Controller;

    class Index extends Controller{
        public function index(){
        	$this->assign('sex','18');
            $data = [
                'email' => '77766@qq.com',
                'name' => 'heber'
            ];
            return $this->fetch('',$data);
        }
    }

```
除此之外，我们还可以用$this->assign('name','heber')来传参。第一个是键(name)，第二个是键值(heber)。在前端页面调用的方法也和view()一样.

除此之外，还有$this->display(),他可以用来直接输出内容，包括文字和变量，例如

 return $this->display('worinidaye{$sex}',['sex' => 'male']);

 这句话会在前台展示一串字符"worinidayemale",我们也可以先用$this->assign()方法先定义好变量，再用$this->display()来输出，$this->display()比较适用于测试，它方便，但没有实现前后端分离。

## 变量输出、赋值和替换

在上面，我们有说到，前端页面使用{$name}这个形式来使用$name变量，在配置中，我们也可以更改花括号以其他字符来替代，以配合其他框架的使用。在/thinkphp/convention.php中，找到'trmplate',它的'tpl_begin'以及'tpl_end'就是用来设置开始和结束标记符的。

```objc
    'template'               => [
        // 模板引擎类型 支持 php think 支持扩展
        'type'         => 'Think',
        // 视图基础目录，配置目录为所有模块的视图起始目录
        'view_base'    => '',
        // 当前模板的视图目录 留空为自动获取
        'view_path'    => '',
        // 模板后缀
        'view_suffix'  => 'html',
        // 模板文件名分隔符
        'view_depr'    => DS,
        // 模板引擎普通标签开始标记
        'tpl_begin'    => '{',
        // 模板引擎普通标签结束标记
        'tpl_end'      => '}',
        // 标签库标签开始标记
        'taglib_begin' => '{',
        // 标签库标签结束标记
        'taglib_end'   => '}',
    ],
```

我们可以用fetch()、view()的第三个参数来替换变量

$this->fetch('index',[],['_static_' => 'happy']);
view('',[],['_move_' => 'bad']);

这样，前端文件中的所有"_static_","_move_"都会被替换成"happy"和"bad"。TP5默认把'__JS__'和'__CSS__'替换成'/static/js'和'/static/css',这样方便了我们后期的路径变更，我们可以在'view_replace_str'       => [],这里修改'__JS__'和'__CSS__'的替换值。

## 系统变量原生标签

